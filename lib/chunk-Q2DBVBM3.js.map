{"version":3,"sources":["../src/schemas/metadata/MetadataObject.ts"],"names":["MetadataObject","name","properties","description","jsDocTags","index","validated","recursive","nullables","tagged_","literal_","props","slice","create","_From_without_properties","obj","_Messagable","length","every","p","key","isSoleLiteral","_Is_simple","level","property","value","size","isRequired","nullable","atomics","objects","_Is_literal","startsWith","last","substr","Number","isNaN","isInteger","toJSON","map","intersects","x","y","some","prop","find","oppo","getName","undefined","covers"],"mappings":"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","sourcesContent":["import { ClassProperties } from \"../../typings/ClassProperties\";\n\nimport { IJsDocTagInfo } from \"./IJsDocTagInfo\";\nimport { IMetadataObject } from \"./IMetadataObject\";\nimport { MetadataProperty } from \"./MetadataProperty\";\n\nexport class MetadataObject {\n  public readonly name: string;\n  public readonly properties: Array<MetadataProperty>;\n  public readonly description: string | undefined;\n  public readonly jsDocTags: IJsDocTagInfo[];\n\n  public readonly index: number;\n  public validated: boolean;\n  public recursive: boolean;\n  public nullables: boolean[] = [];\n\n  /**\n   * @internal\n   */\n  public tagged_: boolean = false;\n\n  /**\n   * @internal\n   */\n  private literal_?: boolean;\n\n  /* -----------------------------------------------------------\n        CONSTRUCTORS\n    ----------------------------------------------------------- */\n  /**\n   * @hidden\n   */\n  private constructor(props: Omit<ClassProperties<MetadataObject>, \"tagged_\">) {\n    this.name = props.name;\n    this.properties = props.properties;\n    this.description = props.description;\n    this.jsDocTags = props.jsDocTags;\n\n    this.index = props.index;\n    this.validated = props.validated;\n    this.recursive = props.recursive;\n    this.nullables = props.nullables.slice();\n\n    this.tagged_ = false;\n  }\n\n  /**\n   * @internal\n   */\n  public static create(\n    props: Omit<ClassProperties<MetadataObject>, \"tagged_\">,\n  ) {\n    return new MetadataObject(props);\n  }\n\n  /**\n   * @internal\n   */\n  public static _From_without_properties(obj: IMetadataObject): MetadataObject {\n    return MetadataObject.create({\n      name: obj.name,\n      properties: [],\n      description: obj.description,\n      jsDocTags: obj.jsDocTags,\n\n      index: obj.index,\n      validated: false,\n      recursive: obj.recursive,\n      nullables: obj.nullables.slice(),\n    });\n  }\n\n  /**\n   * @internal\n   */\n  public _Messagable(): boolean {\n    return (\n      this.properties.length >= 1 &&\n      this.properties.every((p) => p.key.isSoleLiteral())\n    );\n  }\n\n  /**\n   * @internal\n   */\n  public _Is_simple(level: number = 0): boolean {\n    return (\n      this.recursive === false &&\n      this.properties.length < 10 &&\n      this.properties.every(\n        (property) =>\n          property.key.isSoleLiteral() &&\n          property.value.size() === 1 &&\n          property.value.isRequired() === true &&\n          property.value.nullable === false &&\n          (property.value.atomics.length === 1 ||\n            (level < 1 &&\n              property.value.objects.length === 1 &&\n              property.value.objects[0]!._Is_simple(level + 1))),\n      )\n    );\n  }\n\n  /**\n   * @internal\n   */\n  public _Is_literal(): boolean {\n    return (this.literal_ ??= (() => {\n      if (this.recursive === true) return false;\n      else if (this.name === \"__type\") return true;\n      else if (this.name.startsWith(\"__type.o\") === false) return false;\n\n      const last: string = this.name.substr(\"__type.o\".length);\n      const value: number = Number(last);\n      return isNaN(value) === false && Number.isInteger(value);\n    })());\n  }\n\n  public toJSON(): IMetadataObject {\n    return {\n      name: this.name,\n      properties: this.properties.map((property) => property.toJSON()),\n      description: this.description,\n      jsDocTags: this.jsDocTags,\n\n      index: this.index,\n      recursive: this.recursive,\n      nullables: this.nullables.slice(),\n    };\n  }\n}\n\n/**\n * @internal\n */\nexport namespace MetadataObject {\n  export const intersects = (x: MetadataObject, y: MetadataObject): boolean =>\n    x.properties.some(\n      (prop) =>\n        y.properties.find(\n          (oppo) => prop.key.getName() === oppo.key.getName(),\n        ) !== undefined,\n    );\n\n  export const covers = (x: MetadataObject, y: MetadataObject): boolean =>\n    x.properties.length >= y.properties.length &&\n    x.properties.every(\n      (prop) =>\n        y.properties.find(\n          (oppo) => prop.key.getName() === oppo.key.getName(),\n        ) !== undefined,\n    );\n}\n"]}