{"version":3,"sources":["../src/programmers/internal/application_escaped.ts"],"sourcesContent":["import { OpenApi, OpenApiV3 } from \"@samchon/openapi\";\n\nimport { Metadata } from \"../../schemas/metadata/Metadata\";\nimport { MetadataEscaped } from \"../../schemas/metadata/MetadataEscaped\";\n\n/**\n * @internal\n */\nexport const application_escaped =\n  <Version extends \"3.0\" | \"3.1\">(\n    generator: (meta: Metadata) => Schema<Version>,\n  ) =>\n  (resolved: MetadataEscaped): Schema<Version>[] => {\n    const output: Schema<Version> | null = generator(resolved.returns);\n    if (output === null) return [];\n\n    if (is_date(new Set())(resolved.original)) {\n      const string: StringSchema<Version> | undefined = is_string(output)\n        ? output\n        : is_one_of(output)\n          ? output.oneOf.find(is_string)\n          : undefined;\n      if (\n        string !== undefined &&\n        string.format !== \"date\" &&\n        string.format !== \"date-time\"\n      )\n        string.format = \"date-time\";\n    }\n    return is_one_of(output)\n      ? (output.oneOf as OneOfSchema<Version>[])\n      : [output];\n  };\n\n/**\n * @internal\n */\nconst is_string = <Version extends \"3.0\" | \"3.1\">(\n  elem: Schema<Version>,\n): elem is StringSchema<Version> =>\n  (elem as StringSchema<Version>).type === \"string\";\n\n/**\n * @internal\n */\nconst is_one_of = <Version extends \"3.0\" | \"3.1\">(\n  elem: Schema<Version>,\n): elem is OneOfSchema<Version> =>\n  Array.isArray((elem as OneOfSchema<Version>).oneOf);\n\n/**\n * @internal\n */\nconst is_date =\n  (visited: Set<Metadata>) =>\n  (meta: Metadata): boolean => {\n    if (visited.has(meta)) return false;\n    visited.add(meta);\n\n    return (\n      meta.natives.some((name) => name === \"Date\") ||\n      meta.arrays.some((array) => is_date(visited)(array.type.value)) ||\n      meta.tuples.some((tuple) => tuple.type.elements.some(is_date(visited))) ||\n      meta.aliases.some((alias) => is_date(visited)(alias.value))\n    );\n  };\n\ntype Schema<Version extends \"3.0\" | \"3.1\"> = Version extends \"3.0\"\n  ? OpenApiV3.IJsonSchema\n  : OpenApi.IJsonSchema;\ntype StringSchema<Version extends \"3.0\" | \"3.1\"> = Version extends \"3.0\"\n  ? OpenApiV3.IJsonSchema.IString\n  : OpenApi.IJsonSchema.IString;\ntype OneOfSchema<Version extends \"3.0\" | \"3.1\"> = Version extends \"3.0\"\n  ? OpenApiV3.IJsonSchema.IOneOf\n  : OpenApi.IJsonSchema.IOneOf;\n"],"mappings":";;;;;AAQO,IAAMA,sBACX,wBACEC,cAEF,CAACC,aAAAA;AACC,QAAMC,SAAiCF,UAAUC,SAASE,OAAO;AACjE,MAAID,WAAW,KAAM,QAAO,CAAA;AAE5B,MAAIE,QAAQ,oBAAIC,IAAAA,CAAAA,EAAOJ,SAASK,QAAQ,GAAG;AACzC,UAAMC,SAA4CC,UAAUN,MAAAA,IACxDA,SACAO,UAAUP,MAAAA,IACRA,OAAOQ,MAAMC,KAAKH,SAAAA,IAClBI;AACN,QACEL,WAAWK,UACXL,OAAOM,WAAW,UAClBN,OAAOM,WAAW,YAElBN,QAAOM,SAAS;EACpB;AACA,SAAOJ,UAAUP,MAAAA,IACZA,OAAOQ,QACR;IAACR;;AACP,GAvBA;AA4BF,IAAMM,YAAY,wBAChBM,SAECA,KAA+BC,SAAS,UAHzB;AAQlB,IAAMN,YAAY,wBAChBK,SAEAE,MAAMC,QAASH,KAA8BJ,KAAK,GAHlC;AAQlB,IAAMN,UACJ,wBAACc,YACD,CAACC,SAAAA;AACC,MAAID,QAAQE,IAAID,IAAAA,EAAO,QAAO;AAC9BD,UAAQG,IAAIF,IAAAA;AAEZ,SACEA,KAAKG,QAAQC,KAAK,CAACC,SAASA,SAAS,MAAA,KACrCL,KAAKM,OAAOF,KAAK,CAACG,UAAUtB,QAAQc,OAAAA,EAASQ,MAAMX,KAAKY,KAAK,CAAA,KAC7DR,KAAKS,OAAOL,KAAK,CAACM,UAAUA,MAAMd,KAAKe,SAASP,KAAKnB,QAAQc,OAAAA,CAAAA,CAAAA,KAC7DC,KAAKY,QAAQR,KAAK,CAACS,UAAU5B,QAAQc,OAAAA,EAASc,MAAML,KAAK,CAAA;AAE7D,GAXA;","names":["application_escaped","generator","resolved","output","returns","is_date","Set","original","string","is_string","is_one_of","oneOf","find","undefined","format","elem","type","Array","isArray","visited","meta","has","add","natives","some","name","arrays","array","value","tuples","tuple","elements","aliases","alias"]}