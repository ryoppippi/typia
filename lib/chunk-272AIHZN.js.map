{"version":3,"sources":["../src/factories/CommentFactory.ts"],"names":["ts","CommentFactory","description","symbol","includeTags","node","declarations","undefined","major","minor","versionMajorMinor","split","map","Number","content","main","displayPartsToString","getDocumentationComment","length","push","getJsDocTags","tag","text","name","line","join","elements","getJSDocCommentsAndTags","comment","isJSDoc","parsed","getTextOfJSDocComment","tags","parseJSDocTag","output","merge","comments","part","str","getText","tagName","filter"],"mappings":";;;;;AAAA,OAAOA,QAAQ;;UAEEC,iBAAAA;kBACFC,cAAc,CACzBC,QACAC,cAAuB,UAAK;AAE5B,UAAMC,OAAOF,OAAOG,eAAe,CAAA;AACnC,QAAI,CAACD,KAAM,QAAOE;AAGlB,UAAM,CAACC,OAAOC,KAAAA,IAAST,GAAGU,kBAAkBC,MAAM,GAAA,EAAKC,IAAIC,MAAAA;AAI3D,QAAIL,QAAQ,KAAMA,UAAU,KAAKC,QAAQ,GAAI;AAC3C,YAAMK,WAAoB,CAAA;AAC1B,YAAMC,OAAef,GAAGgB,qBACtBb,OAAOc,wBAAwBV,MAAAA,CAAAA;AAEjC,UAAIQ,KAAKG,QAAQ;AACfJ,QAAAA,SAAQK,KAAKJ,IAAAA;AACb,YAAIX,eAAeD,OAAOiB,aAAY,EAAGF,OAAQJ,CAAAA,SAAQK,KAAK,EAAA;MAChE;AACA,UAAIf,YACF,YAAWiB,OAAOlB,OAAOiB,aAAY,GAAI;AACvCN,QAAAA,SAAQK,KACNE,IAAIC,OACA,IAAID,IAAIE,IAAI,IAAIvB,GAAGgB,qBAAqBK,IAAIC,IAAI,CAAA,KAChD,IAAID,IAAIE,IAAI,EAAE;MAEtB;AACF,aAAOT,SAAQI,SACXJ,SAAQF,IAAI,CAACY,SAASA,KAAKb,MAAM,MAAA,EAAQc,KAAK,IAAA,CAAA,EAAOA,KAAK,IAAA,IAC1DlB;IACN;AAGA,UAAMmB,WACJ1B,GAAG2B,wBAAwBtB,IAAAA;AAC7B,QAAIqB,SAASR,WAAW,EAAG,QAAOX;AAElC,UAAMO,UAAoB,CAAA;AAC1B,eAAWc,WAAWF,UAAU;AAC9B,UAAI1B,GAAG6B,QAAQD,OAAAA,GAAU;AACvB,cAAME,SAA6B9B,GAAG+B,sBACpCH,QAAQA,OAAO;AAEjB,YAAIE,QAAQZ,QAAQ;AAClBJ,kBAAQK,KAAKW,MAAAA;AACb,cAAI1B,eAAewB,QAAQI,MAAMd,OAAQJ,SAAQK,KAAK,EAAA;QACxD;AACA,YAAIf,YACF,YAAWiB,OAAOO,QAAQI,QAAQ,CAAA,EAChClB,SAAQK,KAAKc,cAAcZ,GAAAA,CAAAA;MACjC,WAAWjB,YAAaU,SAAQK,KAAKc,cAAcL,OAAAA,CAAAA;IACrD;AACA,UAAMM,SAAiBpB,QACpBF,IAAI,CAACY,SAASA,KAAKb,MAAM,MAAA,EAAQc,KAAK,IAAA,CAAA,EACtCA,KAAK,IAAA;AACR,WAAOS,OAAOhB,SAASgB,SAAS3B;EAClC;kBAEa4B,QAAQ,CAACC,aACpBA,SACGxB,IAAI,CAACyB,SAASA,KAAKf,IAAI,EACvBV,IAAI,CAAC0B,QAAQA,IAAI3B,MAAM,MAAA,EAAQc,KAAK,IAAA,CAAA,EACpCA,KAAK,EAAA;AACZ,GAlEiBxB,mBAAAA,iBAAAA,CAAAA,EAAAA;AAoEjB,IAAMgC,gBAAgB,wBAACZ,QAAAA;AACrB,QAAME,OACJF,IACAE,MAAMgB,QAAAA;AACR,QAAMT,SAA6B9B,GAAG+B,sBAAsBV,IAAIO,OAAO;AACvE,SAAO;IAAC,IAAIP,IAAImB,QAAQlB,IAAI;IAAIC;IAAMO;IACnCW,OAAO,CAACH,QAAQ,CAAC,CAACA,KAAKpB,MAAAA,EACvBO,KAAK,GAAA;AACV,GARsB","sourcesContent":["import ts from \"typescript\";\n\nexport namespace CommentFactory {\n  export const description = (\n    symbol: ts.Symbol,\n    includeTags: boolean = false,\n  ): string | undefined => {\n    const node = symbol.declarations?.[0];\n    if (!node) return undefined;\n\n    // FOR LEGACY TS < 5.2\n    const [major, minor] = ts.versionMajorMinor.split(\".\").map(Number) as [\n      number,\n      number,\n    ];\n    if (major < 5 || (major === 5 && minor < 1)) {\n      const content: string[] = [];\n      const main: string = ts.displayPartsToString(\n        symbol.getDocumentationComment(undefined),\n      );\n      if (main.length) {\n        content.push(main);\n        if (includeTags && symbol.getJsDocTags().length) content.push(\"\");\n      }\n      if (includeTags)\n        for (const tag of symbol.getJsDocTags()) {\n          content.push(\n            tag.text\n              ? `@${tag.name} ${ts.displayPartsToString(tag.text)}`\n              : `@${tag.name}`,\n          );\n        }\n      return content.length\n        ? content.map((line) => line.split(\"\\r\\n\").join(\"\\n\")).join(\"\\n\")\n        : undefined;\n    }\n\n    // NEW FEATURE OF TS 5.2\n    const elements: readonly (ts.JSDoc | ts.JSDocTag)[] =\n      ts.getJSDocCommentsAndTags(node);\n    if (elements.length === 0) return undefined;\n\n    const content: string[] = [];\n    for (const comment of elements) {\n      if (ts.isJSDoc(comment)) {\n        const parsed: string | undefined = ts.getTextOfJSDocComment(\n          comment.comment,\n        );\n        if (parsed?.length) {\n          content.push(parsed);\n          if (includeTags && comment.tags?.length) content.push(\"\");\n        }\n        if (includeTags)\n          for (const tag of comment.tags ?? [])\n            content.push(parseJSDocTag(tag));\n      } else if (includeTags) content.push(parseJSDocTag(comment));\n    }\n    const output: string = content\n      .map((line) => line.split(\"\\r\\n\").join(\"\\n\"))\n      .join(\"\\n\");\n    return output.length ? output : undefined;\n  };\n\n  export const merge = (comments: ts.SymbolDisplayPart[]): string =>\n    comments\n      .map((part) => part.text)\n      .map((str) => str.split(\"\\r\\n\").join(\"\\n\"))\n      .join(\"\");\n}\n\nconst parseJSDocTag = (tag: ts.JSDocTag): string => {\n  const name: string | undefined = (\n    tag as ts.JSDocParameterTag\n  ).name?.getText();\n  const parsed: string | undefined = ts.getTextOfJSDocComment(tag.comment);\n  return [`@${tag.tagName.text}`, name, parsed]\n    .filter((str) => !!str?.length)\n    .join(\" \");\n};\n"]}